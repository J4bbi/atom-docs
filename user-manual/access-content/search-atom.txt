.. _search-atom:

======
Search
======

.. |desc| image:: images/descriptions-icon.png
   :height: 24
   :width: 24

.. |desc2| image:: images/descriptions-icon.png
   :height: 18
   :width: 18

To help users locate and manage content, AtoM includes powerful search
support, available anywhere in the application through the :term:`search box`
located in the AtoM :term:`header bar`, or through one of the many dedicated
search boxes for specific :term:`entities <entity>` or record types. As of
release 2.0.0, AtoM now uses `Elasticsearch <http://www.elasticsearch.org/>`__
to power its search functionality - Elasticsearch is an open source
distributed search server based on Apache Lucene, which acts as AtoM's new
search and analytic engine.

This section of the User Manual will cover the features available in the
:term:`search box` (including faceted typeahead results, institutional search box
delimiters, and filter tags), and it will walk users through how to search
for archival descriptions. Additionally, an outline of each of the dedicated
search bars available throughout the application is provided, with
instructions on how to search for different record types in each.

**Below you will find an overview of:**

* :ref:`atom-search-box`

  * :ref:`search-typeahead`
  * :ref:`search-box-delimiters`
  * :ref:`search-results-facets`

* :ref:`search-archival-descriptions`
* :ref:`dedicated-search`

  * :ref:`dedicated-search-authority`
  * :ref:`dedicated-search-accessions`
  * :ref:`dedicated-search-places`
  * :ref:`dedicated-search-subjects`
  * :ref:`dedicated-search-donors`
  * :ref:`dedicated-search-rights`
  * :ref:`dedicated-search-functions`
  * :ref:`dedicated-search-users`

**REMEMBER: Users, places, subjects, functions? in 2.0.1, not 2.0.0!**

.. SEEALSO::

   * :ref:`Advanced search <advanced-search>`
   * :ref:`navigate`

.. _atom-search-box:

The AtoM Search box |searchbox|
===============================

.. |searchbox| image:: images/search-box.png
   :height: 30px

The search box is the primary means to find descriptions in AtoM that contain
text matching a search query. The search box is located in the
:term:`header bar` on all AtoM pages, including the home page. By default,
when a user enters text and presses enter, the results returned are for
:term:`archival descriptions <archival description>`. However, other
record-type results can be discovered via the :term:`typeahead` results
presented in the search box (see: :ref:`below <search-typeahead>`).

Search terms entered in the search box are, by default, searched with an "OR"
operator - that is to say, searching for *kitty cat* would by default search
*kitty* OR *kat*. AtoM supports a number of :term:`Boolean <boolean search>`
operators - see: :ref:`Advanced search <advanced-search>`.

.. _search-typeahead:

Typeahead and faceted search box results
-----------------------------------------

.. figure:: images/typeahead.*
   :align: right
   :figwidth: 40%
   :width: 100%
   :alt: Example of the typeahead in the search box

   As a user types, typeahead search suggestions appear below the search box.

Additionally, the AtoM search box also implements :term:`typeahead` - as a user
enters text into the search box, one or more possible matches are found and
presented to the user in a :term:`drop-down <drop-down menu>` below the search
box, which continue to narrow as the user enters further text. This allows a
user to dynamically view results and select a resource without necessarily
having to enter its full name or title. The search box :term:`typeahead`
results are organized into record-type categories (or :term:`facets <facet
filter>`), including:

* :term:`Archival description`
* :term:`Authority record`
* :term:`Archival institution`

When multiple results for a record type exist, the :term:`typeahead`
drop-down includes an option to view all records for a particular record
type - clicking the "View all" link for a particular type of record will
redirect the user to a :ref:`browse page <page-type-browse>` of results.

The :term:`typeahead` is set by default to begin providing suggestions only
after at least three characters have been entered - for example, entering "a"
or "an" in the search box will not prompt suggestions, but entering "ant"
might produce suggestions such as an authority record for a person named
"Anthony," etc.

.. IMPORTANT::

   The :term:`typeahead` search results are intended as a navigational tool
   for quick searching of multiple :ref:`entity types <entity-types>`, but
   **by default pressing enter after entering a query in the search bar will
   load a results page for archival descriptions**. If you wish to search for
   an :term:`authority record` or :term:`archival institution` using the main
   search box, you must either click it when it appears in the drop-down, or
   alternately select it from a browse page when clicking the "all matching"
   option below each search facet in the typeahead. At this time, the main
   :term:`search box` cannot be configured to return other record types when
   pressing enter. However, there are also dedicated search bars for authority
   records and archival institutions -- see :ref:`below <dedicated-search>`.

.. _search-box-delimiters:

Institutional search box delimiters
-----------------------------------

.. figure:: images/search-delimiter.*
   :align: right
   :figwidth: 40%
   :width: 100%
   :alt: Example of the search delimiters below the search box

   When viewing an archival description linked to an archival institution, or
   the institution record, the option to limit your search to the current
   institution appears as a radio button in a drop-down beneath the search
   box.

To better support the use of AtoM as a :term:`multi-repository system`, AtoM
provides users with an institutional search box delimiter that can be toggled
between a global search setting and a setting restricted to the
:term:`holdings` of a particular :term:`archival institution`.

When a user has viewed an :term:`archival institution` record or an
:term:`archival description` related to an archival institution, clicking in
the search box will reveal a set of :term:`radio buttons <radio button>` that
allow the user limit the search results to the holdings of the most recently
viewed :term:`archival institution`, or to search globally (i.e., across all
records in the application).

Help text appears in the :term:`search box` to indicate at a glance which
setting is engaged: if the search box text says "Search", the delimiter is set
to perform a global search. If the help text says "Search [Name of
Institution]" (where the name of the current related institution appears),
this indicates that the delimiter is set to limit search box query results to
the :term:`holdings` of that institution.

.. NOTE::

   When a user views a linked :term:`archival description` or an
   :term:`archival institution` record, the :term:`search box` delimiter will
   **default to search within that institution**. If you would like to
   perform a global search (i.e. across all records in the application),
   switch the radio button to *Global search* before proceeding. See below
   for further instructions on using the search box delimiters.

When the delimiter is set to limit search results to a specific
:term:`archival institution`, :term:`typeahead` search results for
:term:`archival descriptions <archival description>` will also be limited to
the :term:`holdings` of that institution. However, other typehead results,
such as :term:`authority record` and :term:`archival institution`
suggestions, will **not** be limited (instead AtoM will continue to make
suggestions from all records in the application for those types).

.. _search-delimiter-filter-tag:

Filter tags
^^^^^^^^^^^

If a user enters a search query in the :term:`search box` while the delimiter.
is set to a particular :term:`repository` and presses enter, the
:ref:`search results <page-type-search>` page will include a :term:`filter tag`
at the top of the results, to offer a visual cue to the user that the results
are limited to those of a specific :term:`archival institution`. Clicking the
"**X**" on the filter tag will remove it, and the results page will reload and
display global search results. This offers two advantages to the user:

* When a delimited search is performed, the user is given a clear visual
  indication (the filter tag bearing the :term:`repository` name)
* If a delimited search is performed *by accident* (i.e. the user meant to
  perform a global search), the filter can be removed without having to
  perform the search again.

.. figure:: images/search-filter-tag.*
   :align: center
   :figwidth: 80%
   :width: 100%
   :alt: Example of a filter tag on a search results page

   An example of a search results page with a filter tag visible - in this
   instance, the user has performed a search for "allan" delimited to the
   holdings of the Desoronto Archives

.. _search-using-delimiters:

Using the Institutional search box delimiters
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Navigate to an :term:`archival description` linked to an :term:`archival
   institution`, or to an archival institution's page. You can do this either
   by searching for the name of the institution or description, or by
   :ref:`browsing <browse>`.
2. Place your cursor in the :term:`search box` located in the AtoM
   :term:`header bar`. A :term:`drop-down menu` will appear beneath the search
   box with two radio buttons.
3. By default, the radio button will be set to the related :term:`archival
   institution`. If you would like to search within the :term:`holdings` of
   that institution, you can begin typing your query.
4. If you would like to search all records held in AtoM (i.e. globally), click
   the "Global search" radio button in the :term:`drop-down <drop-down
   menu>`. Begin typing your query.
5. If you see the result you are looking for appear in the :ref:`typeahead
   <search-typeahead>`, you can click it to go straight to the record - AtoM
   will redirect you to the selected description's :term:`view page`.
6. When you have entered your search term(s), press enter to submit and begin
   your search. AtoM will redirect you to a :ref:`search results
   <page-type-search>` page with descriptions that contain data that match
   your search query.
7. If you have used the institutional search box delimiter, a :term:`filter
   tag` will appear at the top of your search results, indicating that these
   results have been limited to the current :term:`repository`. If you wish
   to broaden the search results to all records in AtoM (i.e., if you did not
   intend to use the institutional search delimiter), you can click the
   "**X**" on the :term:`filter tag` to remove it; AtoM will reload global
   search results.
8. The search results page includes a number :term:`facet filters <facet
   filter>`, to help you sort through the results and find the content you are
   looking for. For more information on working with facet filters, see:
   :ref:`recurring-facet-filters`.
9. Search results can be sorted either alphabetically, or by most-recently
   updated, using the :term:`sort button` available at the top-left side of
   the search results. For more information, see:
   :ref:`recurring-sort-button`.


:ref:`Back to top <search-atom>`


.. _search-results-facets:

Search results and facet filters
--------------------------------

AtoM's search and browse pages include a number of :ref:`facet filters
<recurring-facet-filters>` to enhance a user's ability to quickly sift
through results and find specific records.

**For more information on using the facet filters in AtoM, see:**

* :ref:`recurring-facet-filters`

:ref:`Back to top <search-atom>`

.. _search-archival-descriptions:

|desc| Search for archival descriptions
=======================================

Searching for archival descriptions is accomplished using the :term:`search
box` located in the AtoM :term`header bar`, available anywhere in the
application. Though other kinds of record results can be found using the
:term:`typeahead` features of the general search box (see: :ref:`Typeahead
<search-typeahead>`, above), when a user enters a search term and presses
enter, by default the search box will return results for archival
descriptions. The following will outline some of the steps involved in
searching for :term:`archival descriptions <archival description>`.

.. IMPORTANT::

   Only authenticated (i.e. logged in) users with :term:`access privileges
   <access privilege>` to view drafts will be able to see draft descriptions
   in search and browse results. For more information on draft vs. published,
   and changing the publication status of an :term:`archival description`,
   see: :ref:`publish-archival-description`.

.. TIP::

   Trying to find a specific record inside a :term:`fonds`,
   :term:`collection`, or series? Check out the section below on our
   :ref:`treeview-search`.

**To search for archival descriptions in AtoM:**

1. Place your cursor in the :term:`search box` located in the :term:`header
   bar` at the top of the page.
2. A :term:`drop-down menu` will appear. If you were viewing an :term:`archival
   institution`, or an :term:`archival description` linked to an archival
   institution when you placed your cursor in the :term:`search box`, the
   :ref:`search box delimiter <search-box-delimiters>` will be set for the
   current related institution (otherwise, the only option will be "Global
   search"). If you wish to search **only** within the selected institution,
   leave the :term:`radio button` set to search the current institution. If
   you wish to search **all records** in AtoM (i.e. globally, across
   institutions), click the "Global search" radio button.

.. image:: images/search-box-dropdown.*
   :align: center
   :width: 70%
   :alt: An image of the search box delimiters

3. Begin to enter your search term. As you type, :term:`typeahead` results
   will begin to appear in the search box dropdown. For more information on
   typeahead in search, see above - :ref:`search-typeahead`. The results that
   appear as you type will be faceted by :term:`entity` - those with the
   |desc2| description icon next to them are :term:`archival descriptions
   <archival description>`.

.. image:: images/typeahead-desc.*
   :align: center
   :width: 70%
   :alt: An image typeahead results as a user types in the search box

4. If you see the record you are looking for in the faceted results provided
   by the :term:`typeahead`, click the title in the search box :term:`drop-
   down <drop-down menu>` to navigate to it. If you don't, or would like to
   see more results, finish entering your search term and press enter.
5. If you have pressed enter, AtoM will redirect you to a search results page.
   The following image has been annotated with numbers (in orange circles) to
   outline some of the features of the results page that will help you
   navigate, and narrow your search:

.. image:: images/search-results.*
   :align: center
   :width: 80%
   :alt: An image of an example search results page

* **A**: The search term you have entered will be shown at the top of a search
  results page in black, for context. In this example, the search term
  "anderson" has been entered.
* **B**: Next to the search term, a count of the number of total matching
  results returned is shown in grey. In this example, there are 117 archival
  descriptions returned for the search "anderson"
* **C**: Results appear in the main column of the page - click on a result
  and AtoM will take you to a :term:`view page` for the related
  :term:`archival description`. Additionally, the results include helpful
  contextual information, including:

  * *Level of description* - i.e. fonds, series, file, item, etc.
  * *Publication status* - if a description's publication status is "draft"
    (i.e. it is not visible to public users), the draft status will be
    indicated in the stub record. In this screenshot, the first 2 results
    (Anderson, A. and Anderson, Joseph) are draft records.
  * *Description* - if a scope and content note has been included in the
    archival description, its first 2 lines will be visible here for greater
    context. In the example screenshot, the S. Boyd Anderson fonds and the
    results below it are displaying scope and content summaries.
  * *Identifier* - if a reference code or other identifier has been added to
    the record, the results will display this in orange. In the example
    screenshot, this is visible on the Elizabeth Anderson fonds.
  * *Creator name* - if a creator's :term:`authority record` has been linked
    to an archival description, the results stub will display the creator
    name below the scope and content summary. In the example screenshot, this
    is shown in the Anderson Department Store fonds and the Elizabeth
    Anderson fonds.

* **D**: Search result pages include :term:`facet filters <facet filter>` to
  help you narrow your search further. For more information on facet filters
  and using them in AtoM, see :ref:`recurring-facet-filters`. Facets
  available on archival description search/browse pages include:

  * **Language:** Filters for content in a different available language (i.e.,
    if the content has been tranlsated into more than one language)
  * **Archival institution:** Limits results to only the holdings of the
    selected institution
  * **Creator:** Limits results to only those where the :term:`name` matches
    that of the :term:`creator` associated with the :term:`archival description`
  * **Name:** Limits results to those with a matching :term:`name` added as a
    name :term:`access point` to an :term:`archival description`
  * **Place:** Limits results to those with a matching :term:`place` added as a
    place :term:`access point` to an :term:`archival description`
  * **Subject:** Limits results to those with a matching :term:`subject` added
    as a subject :term:`access point` to an :term:`archival description`
  * **Level of description:** Limits results to those that match the selected
    :term:`level of description` (e.g. fonds, collection, series, file, item,
    etc.)
  * **Media type:** Limits results to those with a :term:`digital object`
    attached that matches the selected media type (image, audio, text, video,
    or other)

* **E**: A count of the number of results with :term:`digital objects <digital
  object>` (i.e. an image, video, PDF, or other kind of attachment) is
  included at the top of the search results for context, and to help you sift
  through the results quickly. If you are searching for a description with a
  :term:`digital object`, you can limit the results to show only those with
  digital objects with this filter. Click the "Show results with digital
  objects" link in the results header, and AtoM will reload the page.
  Results with digital objects include a :term:`thumbnail` in the results
  stub for context. A :term:`filter tag` (reading "Only digital objects") is
  included for context - you can click the **X** on the filter tag to remove it
  and return to all results (see :ref:`above <search-delimiter-filter-tag>`
  for more on filter tags):

.. image:: images/search-results-objects.*
   :align: center
   :width: 80%
   :alt: An image of an example search results page limited to digital
         objects

.. TIP::

   You can limit the digital object to a specific type of digital object
   (Image, Audio, Video, Text, or Other) using the Media Type
   :term:`facet filter` available on the left-hand column of the search
   results page. For more information on Facet filters in AtoM, see:
   :ref:`recurring-facet-filters`.

6. When you have found the :term:`archival description` you are looking for,
   click on its title, and AtoM will take you to the description's
   :term:`view page`.
7. If you do not see the record you are looking for, you can use the pager
   included at the bottom of the page to keep browsing the results. **NOTE:**
   whether or not there is a pager included will depend on the number of results
   returned, and the "Results per page" setting in **Admin > Settings >
   Global > Results per page**. If it is set at the default 10 results per
   page, and your search has returned more than 10 results, you will see a
   pager at the bottom of the page like so:

.. image:: images/results-pager.*
   :align: center
   :width: 50%
   :alt: An image of a pager at the bottom of a search results page

8. If you still have not found the description you are searching for, you can
   try using the Advanced search interface. For more information, see:
   :ref:`advanced-search`.

.. _treeview-search:

Treeview quick search
----------------------

.. image:: images/quicksearch-tab.*
   :align: right
   :width: 25%
   :alt: An image of the treeview quick search tab on an archival description

In addition to AtoM's general search, the :term:`treeview` included in the
:term:`context menu` of an archival description :term:`view page` also
includes a "Quick search" tab, to help users quickly locate specific
descriptions in a deep hierarchy. This is especially useful when using AtoM for
archival arrangement and description over several sessions, to quickly return
to a specific record when a :term:`fonds` or :term:`collection` includes many
lower levels of description.

The Quick search is **NOT** a full-featured search - it will search for any
matches on the **title** or **identifier** (i.e. reference code) of
descriptions within the current collection hierarchy. As such, a user will
need to know at least part of the title or identifier of the desired record.
The treeview quick search can be accessed by navigating to an :term:`archival
description`, and clicking the "Quick search" tab above the :term:`treeview`
in the left-hand :term:`context menu` of the description's :term:`view page`.

**TO USE THE TREEVIEW QUICK SEARCH:**

1. Navigate to a top-level :term:`archival description` (i.e. a :term:`fonds`,
   :term:`collection`, series, etc.) with many :term:`child records <child
   record>` (lower levels of description). You can do so by :ref:`searching
   <search-archival-descriptions>` or :ref:`browsing <browse>` - see
   :ref:`access-content` for more information on navigation in AtoM.

.. image:: images/quicksearch.*
   :align: right
   :width: 25%
   :alt: An image of the treeview quick search

2. Once you've arrived at an :term:`archival description`, locate the
   :term:`treeview` in the left-hand :term:`context menu` of the description's
   :term:`view page`. Click the "Quick search" tab.
3. The treeview will disappear, and a search box will be shown in its place
   (note: you can return to the treeview at any time by clicking the
   "Holdings" tab).

.. image:: images/quicksearch-results.*
   :align: right
   :width: 25%
   :alt: An image of the treeview quick search returning results

4. Type a search term and press enter. AtoM will look for matches in the
   titles and identifiers (reference codes) of descriptions in the collection.
5. Matching results will be returned as blue hyperlinks. Click a results title
   to navigate to the related description - AtoM will redirect you to a
   :term:`view page` for the searched archival description.

.. image:: images/quicksearch-results-wildcard.*
   :align: right
   :width: 25%
   :alt: An image of the treeview quick search returning results

6. Note that you can use special characters such as the ***** wildcard symbol
   to improve your search results. For more information on available special
   characters and boolean searching in AtoM, see: :ref:`advanced-search`.


:ref:`Back to top <search-atom>`

.. _dedicated-search:

Dedicated search boxes
======================

Content

Fact that some only return titles for now

.. _dedicated-search-authority:

Authority records
-----------------

content

.. _dedicated-search-accessions:

Accession records
-----------------

content

.. _dedicated-search-places:

Place terms
-----------

content

.. _dedicated-search-subjects:

Subject terms
-------------

content



.. _dedicated-search-donors:

Donors
------

content

.. _dedicated-search-rights:

Rights holders
--------------

content

.. _dedicated-search-functions:

Functions
---------

content

.. _dedicated-search-users:

Users
-----

content


:ref:`Back to top <search-atom>`
